{% extends "base.html" %}

{% block content %}
<h1 class="text-2xl font-semibold text-green-800 mb-6">Yield Prediction</h1>

<div class="bg-white p-6 rounded-lg shadow-md">
    <form method="POST" action="{{ url_for('prediction') }}">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Existing fields -->
            <div>
                <label for="farm_id" class="block text-gray-700 mb-2">Select Farm</label>
                <select id="farm_id" name="farm_id" required 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
                    <option value="">Select a farm</option>
                    {% if farms is not none %}
                        {% for _, farm in farms.iterrows() %}
                            <option value="{{ farm.id }}" data-soil-ph="{{ farm.soil_ph }}" 
                                    data-soil-n="{{ farm.soil_nitrogen }}" data-soil-p="{{ farm.soil_phosphorus }}"
                                    data-soil-k="{{ farm.soil_potassium }}" data-soil-om="{{ farm.soil_organic_matter }}"
                                    data-area="{{ farm.area_hectares }}">
                                {{ farm.name }} - {{ farm.location }}
                            </option>
                        {% endfor %}
                    {% endif %}
                </select>
            </div>
            
            <div>
                <label for="crop_type" class="block text-gray-700 mb-2">Crop Type</label>
                <select id="crop_type" name="crop_type" required 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
                    <option value="">Select a crop</option>
                    {% for crop in crops %}
                        <option value="{{ crop }}">{{ crop|title }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Environmental factors -->
            <div>
                <label for="temperature_avg" class="block text-gray-700 mb-2">Average Temperature (Â°C)</label>
                <input type="number" step="0.1" id="temperature_avg" name="temperature_avg" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="rainfall_total" class="block text-gray-700 mb-2">Total Rainfall (mm)</label>
                <input type="number" step="1" id="rainfall_total" name="rainfall_total" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="humidity_avg" class="block text-gray-700 mb-2">Average Humidity (%)</label>
                <input type="number" step="0.1" id="humidity_avg" name="humidity_avg" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="sunlight_hours" class="block text-gray-700 mb-2">Daily Sunlight Hours</label>
                <input type="number" step="0.1" id="sunlight_hours" name="sunlight_hours" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <!-- Soil properties -->
            <div>
                <label for="soil_ph" class="block text-gray-700 mb-2">Soil pH</label>
                <input type="number" step="0.1" min="0" max="14" id="soil_ph" name="soil_ph" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="soil_nitrogen" class="block text-gray-700 mb-2">Soil Nitrogen (%)</label>
                <input type="number" step="0.01" min="0" max="100" id="soil_nitrogen" name="soil_nitrogen" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="soil_phosphorus" class="block text-gray-700 mb-2">Soil Phosphorus (%)</label>
                <input type="number" step="0.01" min="0" max="100" id="soil_phosphorus" name="soil_phosphorus" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="soil_potassium" class="block text-gray-700 mb-2">Soil Potassium (%)</label>
                <input type="number" step="0.01" min="0" max="100" id="soil_potassium" name="soil_potassium" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="soil_organic_matter" class="block text-gray-700 mb-2">Soil Organic Matter (%)</label>
                <input type="number" step="0.01" min="0" max="100" id="soil_organic_matter" name="soil_organic_matter" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <!-- Management practices -->
            <div>
                <label for="fertilizer_planned" class="block text-gray-700 mb-2">Fertilizer (kg/hectare)</label>
                <input type="number" step="1" id="fertilizer_planned" name="fertilizer_planned" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="irrigation_planned" class="block text-gray-700 mb-2">Irrigation (mm)</label>
                <input type="number" step="1" id="irrigation_planned" name="irrigation_planned" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="area_hectares" class="block text-gray-700 mb-2">Area (hectares)</label>
                <input type="number" step="0.1" id="area_hectares" name="area_hectares" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
            </div>
            
            <div>
                <label for="model_type" class="block text-gray-700 mb-2">Prediction Model</label>
                <select id="model_type" name="model_type" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-600">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                    <option value="svm">Support Vector Machine</option>
                    <option value="neural_network">Neural Network</option>
                </select>
            </div>
        </div>
        
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md">
            Predict Yield
        </button>
    </form>
</div>

<div class="mt-8 bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold text-green-800 mb-4">How It Works</h2>
    <p class="text-gray-700 mb-4">Our system uses machine learning models trained on historical agricultural data to predict crop yields based on environmental conditions, soil composition, and farming practices.</p>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-green-50 p-4 rounded-lg">
            <h3 class="font-semibold text-green-700 mb-2">1. Input Data</h3>
            <p class="text-sm">Provide details about your farm, crop, soil composition, and environmental conditions.</p>
        </div>
        
        <div class="bg-green-50 p-4 rounded-lg">
            <h3 class="font-semibold text-green-700 mb-2">2. ML Analysis</h3>
            <p class="text-sm">Our algorithms analyze the data using multiple machine learning models with real-time accuracy metrics.</p>
        </div>
        
        <div class="bg-green-50 p-4 rounded-lg">
            <h3 class="font-semibold text-green-700 mb-2">3. Get Prediction</h3>
            <p class="text-sm">Receive accurate yield predictions with confidence estimates and model performance metrics.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-fill farm details when a farm is selected
        document.getElementById('farm_id').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption.value) {
                // Auto-fill soil properties and area
                document.getElementById('soil_ph').value = selectedOption.dataset.soilPh || '';
                document.getElementById('soil_nitrogen').value = selectedOption.dataset.soilN || '';
                document.getElementById('soil_phosphorus').value = selectedOption.dataset.soilP || '';
                document.getElementById('soil_potassium').value = selectedOption.dataset.soilK || '';
                document.getElementById('soil_organic_matter').value = selectedOption.dataset.soilOm || '';
                document.getElementById('area_hectares').value = selectedOption.dataset.area || '';
            }
        });
    });
</script>
{% endblock %}